angular.module("SchadenForm",["ngAnimate","ngMessages","ui.router","ngSanitize","ui.bootstrap","ngFileUpload"]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).config(function(a,b){var c=plugin_base;a.state("form",{url:"",templateUrl:c+"app/SchadenForm/form.html",controller:"SchadenFormController"}).state("form.selection",{url:"/selection",templateUrl:c+"app/SchadenForm/form-selection.html",resolve:{garageData:function(a){return a.fetchWebservice()}}}).state("form.damage",{url:"/damage",templateUrl:c+"app/SchadenForm/form-damage.html",resolve:{garageData:function(a){return a.fetchWebservice()}}}).state("form.request",{url:"/request",templateUrl:c+"app/SchadenForm/form-request.html",resolve:{garageData:function(a){return a.fetchWebservice()}}}).state("form.confirmation",{url:"/confirmation",templateUrl:c+"app/SchadenForm/form-confirmation.html",resolve:{garageData:function(a){return a.fetchWebservice()}}}).state("form.error",{url:"/error",templateUrl:c+"app/SchadenForm/form-error.html"}),b.otherwise("")}).factory("garageService",function(a,b,c){var d={},e=angular.element(document.getElementById("schadenform-wrapper")).attr("data-hasMechanics");return d.garageData={has_mechanics:!(!e||"0"===e),identifier:"dummy"},d.fetchWebservice=function(){return d.garageData},d.getGarageData=function(){return d.garageData},d}).service("anchorSmoothScroll",function(){this.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function c(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!==document.body;)d=d.offsetParent,c+=d.offsetTop;return c}var d=b(),e=c(a),f=e>d?e-d:d-e;if(f<100)return void scrollTo(0,e);var g=Math.round(f/100);g>=20&&(g=20);var h=Math.round(f/25),i=e>d?d+h:d-h,j=0;if(e>d)for(var k=d;k<e;k+=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i+=h,i>e&&(i=e),j++;else for(var k=d;k>e;k-=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i-=h,i<e&&(i=e),j++}}).controller("SchadenFormController",function(a,b,c,d,e,f,g,h,i){a.resetFormData=function(){a.formData={formType:"",damage:{damageFormType:"body-paint",carParts:{},carSpecs:{},service:"self"},request:{},contactData:{},fileUploads:{}}},a.pluginBase=plugin_base,a.baseUrl=base_url,a.currentState=c.current.name,a.resetFormData(),a.garageData=b.getGarageData(),a.formSubmitted=!1,a.submitButtonDisabled=!1,a.maxUploadSize="4MB",a.setFormType=function(b){"form.damage"===b?a.formData.formType="damage":"form.request"===b&&(a.formData.formType="request")},a.setFormType(c.current.name),a.$on("$stateChangeStart",function(b,c,d,e,f){a.setFormType(c.name),a.formSubmitted=!1,a.submitButtonDisabled=!1}),a.$on("$stateChangeSuccess",function(d,e,f,g,h){"form.error"!==c.current.name&&(a.garageData=b.getGarageData()),"form.confirmation"===c.current.name&&a.resetFormData(),a.currentState=c.current.name}),a.showValidationMessage=function(b){return a.formSubmitted||b.$dirty},a.setDamageFormType=function(b){a.formData.damage.damageFormType=b,i.innerWidth<550&&setTimeout(function(){h.scrollTo("form-begin")},50)},a.isDamageFormTypeActive=function(b){return a.formData.damage.damageFormType===b},a.setCarDamagePart=function(b,c){void 0===a.formData.damage.carParts[b]?a.formData.damage.carParts[b]=c:delete a.formData.damage.carParts[b]},a.isCarspecsFieldRequired=function(){return!0},a.isDamageMessageFieldRequired=function(){return"mechanics"===a.formData.damage.damageFormType},a.isCarDamagePartActive=function(b){return void 0!==a.formData.damage.carParts[b]},a.showCarspecsAdditionalFieldset=!1,a.toggleCarspecsAdditionalFieldset=function(){a.showCarspecsAdditionalFieldset=!1===a.showCarspecsAdditionalFieldset},a.getTemplateUrl=function(b){return e.trustAsResourceUrl(a.pluginBase+b)},a.uploadFile=function(b,c){null!=b&&void 0===b.$error&&(a.submitButtonDisabled=!0,b.upload=f.upload({url:a.baseUrl+"/damage_form/upload_image",method:"POST",file:b,fileFormDataName:"image_upload"}),b.upload.then(function(d){g(function(){void 0!==d.data.success&&(b.result=d.data.data,a.formData.fileUploads[c]=b.result,a.schadenForm[c].$setValidity("maxSize",!0))})},function(b){b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))}),a.submitButtonDisabled=!1)},a.submitForm=function(b){a.formSubmitted=!0,b&&(a.submitButtonDisabled=!0,d({method:"POST",url:a.baseUrl+"/damage_form/submit",params:a.formData}).success(function(b){b.success?(a.resultMessage=b.message,c.go("form.confirmation")):(a.submitButtonDisabled=!1,c.go("form.error"))}).error(function(b){a.submitButtonDisabled=!1,c.go("form.error")}))}}),angular.element(document).ready(function(){angular.bootstrap(document.getElementById("schadenform-wrapper"),["SchadenForm"])});